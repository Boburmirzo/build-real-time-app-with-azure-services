"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("../common");
const queryMetrics_1 = require("../queryMetrics");
/** @hidden */
// TODO: docs
class HeaderUtils {
    static getRequestChargeIfAny(headers) {
        if (typeof headers === "number") {
            return headers;
        }
        else if (typeof headers === "string") {
            return parseFloat(headers);
        }
        if (headers) {
            const rc = headers[common_1.Constants.HttpHeaders.RequestCharge];
            if (rc) {
                return parseFloat(rc);
            }
            else {
                return 0;
            }
        }
        else {
            return 0;
        }
    }
    static getInitialHeader() {
        const headers = {};
        headers[common_1.Constants.HttpHeaders.RequestCharge] = 0;
        headers[common_1.Constants.HttpHeaders.QueryMetrics] = {};
        return headers;
    }
    // TODO: The name of this method isn't very accurate to what it does
    static mergeHeaders(headers, toBeMergedHeaders) {
        if (headers[common_1.Constants.HttpHeaders.RequestCharge] === undefined) {
            headers[common_1.Constants.HttpHeaders.RequestCharge] = 0;
        }
        if (headers[common_1.Constants.HttpHeaders.QueryMetrics] === undefined) {
            headers[common_1.Constants.HttpHeaders.QueryMetrics] = queryMetrics_1.QueryMetrics.zero;
        }
        if (!toBeMergedHeaders) {
            return;
        }
        headers[common_1.Constants.HttpHeaders.RequestCharge] += HeaderUtils.getRequestChargeIfAny(toBeMergedHeaders);
        if (toBeMergedHeaders[common_1.Constants.HttpHeaders.IsRUPerMinuteUsed]) {
            headers[common_1.Constants.HttpHeaders.IsRUPerMinuteUsed] = toBeMergedHeaders[common_1.Constants.HttpHeaders.IsRUPerMinuteUsed];
        }
        if (common_1.Constants.HttpHeaders.QueryMetrics in toBeMergedHeaders) {
            const headerQueryMetrics = headers[common_1.Constants.HttpHeaders.QueryMetrics];
            const toBeMergedHeaderQueryMetrics = toBeMergedHeaders[common_1.Constants.HttpHeaders.QueryMetrics];
            for (const partitionId in toBeMergedHeaderQueryMetrics) {
                if (partitionId in headerQueryMetrics) {
                    const combinedQueryMetrics = headerQueryMetrics[partitionId].add(toBeMergedHeaderQueryMetrics[partitionId]);
                    headerQueryMetrics[partitionId] = combinedQueryMetrics;
                }
                else {
                    headerQueryMetrics[partitionId] = toBeMergedHeaderQueryMetrics[partitionId];
                }
            }
        }
    }
}
exports.HeaderUtils = HeaderUtils;
//# sourceMappingURL=headerUtils.js.map